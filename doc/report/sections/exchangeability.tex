% !TEX root = ../main.tex

% Exchangeability section

\section{Exchangeability}


Throughout this section we assume that all random variables of interest take values in a standard measurable space $(\calX, \calB(\calX))$, unless otherwise stated. We start by defining exchangeability for sequences of random variables in such a setting.

\begin{definition}[Exchangeability] \label{def:exchangeability}
	The random variables $X = X_1, X_2, ..., X_n$ are said to be finitely exchangeable if
	\begin{equation*}
		(X_1, ..., X_n) \equdist (X_{\pi(1)}, ..., X_{\pi(n)})
	\end{equation*}
	for any permutation $\pi$ of $\bbN_n :=\{1, ..., n \}$.\footnote{For the sake of completeness, a permutation $\pi$ of $\bbN_n$ is simply a bijection in $\bbN_n$.} A countable sequence $(X_n)_{n=1}^{\infty}$ of random variables is said to be exchangeable if every finite subsequence of it is finitely exchangeable.
\end{definition}

The notion of exchangeability captures a sense of homogeneity in the population, but it is a weaker assumption than independence and identical distribution, as we show in the following example.


\begin{mdframed}[backgroundcolor=mygray] 
	\begin{example} \label{ex:iid_exch}
		Let $X_1, X_2, ...$ be i.i.d. random variables with common distribution $\mu$. For $n \in \bbN$ consider (without loss of generality) the subsequence $X = (X_1, ..., X_n)$. Then the joint distribution $\mu_n$ of $X$ is, due to independence, the $n$-product of $\mu$: $\mu_n = \mu \times \mu \times \cdots \times \mu$. For any permutation $\pi$ of $\bbN_n$ it is possible to trivially rearrange the products, and so clearly $X \equdist (X_{\pi(1)}, ..., X_{\pi(n)})$. Hence, any i.i.d. sequence is exchangeable.
	\end{example}
\end{mdframed}

The converse of Example \ref{ex:iid_exch} is not true. (See the suplementary exercises.) \\


The main result that follows from exchangeability is de Finetti's representation theorem, which has been proved in increasing generality \cite{deFinetti:1930:RepTheorem, HewittSavage:1955:rep_theorem, DiaconisFreedman:1978:Generalizations}.  

\begin{theorem}[de Finneti] \label{thm:definetti}
	$X = (X_n)_{n=1}^{\infty}$ is an exchangeable sequence of random variables if and only if there exists a unique probability measure $\mu$ on $\calP$---the set of all probability measures on $(\calX, \calB(\calX))$---such that
	\begin{equation} \label{eq:definetti_thm}
		\bbP \{ X_1 \in A_1, ..., X_n \in A_n \} = \int_{\calP}  \prod_{i=1}^n F(A_i) \, \mu(dF)
	\end{equation}
	for every $n \in \bbN$ and $A_1, ..., A_n \in \calB(\calX)$.
\end{theorem}

Observe that the integral in Equation (\ref{eq:definetti_thm}) is over a set of numerical functions---namely, the set of probability measures on $(\calX, \calB(\calX))$. 


\begin{mdframed}[backgroundcolor=mygray] 
	\begin{example} \label{ex:binary_definetti}
		Let $X = X_1, X_2, ...$ be an exchangeable sequence of binary random variables, that is, $\calX = \{0, 1\}$. In this case \cite[see][p.111]{Diaconis:1988:PartialExchang}, de Finetti's theorem asserts the existence of a unique measure $\mu$ such that, for every $n \in \bbN$,
		\begin{equation*}
			\bbP \{ X_1 = x_1, ..., X_n = x_n \} = \int \mu(dp) \, p^s (1-p)^{n-s},
		\end{equation*}
		where $s = \sum_{i=1}^n x_i$ is the number of 1's in the sequence $x_1, ..., x_n$. In other words, there exists a random variable $p$ in the unit interval with distribution $\mu$ such that, given $p$, $X_1, ..., X_n$ are i.i.d. Bernoulli random variables with parameter $p$.
	\end{example}
\end{mdframed}



Technicalities aside, Theorem \ref{thm:definetti} intuitively tells us that, conditional on an unknown distribution $F$ (which is always guaranteed to exist), any subsequence of an exchangeable process can be thought of as a random sample with distribution $F$. This measure plays the role of an infinite-dimensional parameter \cite[][Ch.~4.3]{BernardoSmith:1994:BayesianTheory}. Furthermore, $F$ has a unique prior distribution $\mu$, which justifies the use of a Bayesian approach in settings with exchangeable data. \\


However, there are very general settings where even exchangeability is too strong an assumption. Consider the case of a sequence $(X_n)$ of random variables endowed with covariates $(t_n)$, and such that the distribution of each $X_i$ depends on $t_i$; namely, the setting for regression analysis. It is clear that $(X_n)$ is not an exchangeable sequence, and so de Finetti's representation theorem cannot be immediatly used. Some more general notions of exchangeability to overcome this difficulty have been proposed.


\subsection{Partial exchangeability}


de Finetti \cite{deFinetti:1938:partial_exch} introduced the concept of \textit{partial exchangeability} precisely for settings in which the variables of interest have covariates. The idea, which we formalize below, is to require exchangeability only for variables with the same covariate values.

\begin{definition}[Partial exchangeability]
	Let $X = (X_n)_{n=1}^{\infty}$ be a sequence of random variables, each one of them endowed with a covariate $t_n \in \calT$. For every $t \in \calT$ define the $t$-class $X_t$ to be the subsequence of $X$ such that all the covariates of $X_t$ are $t$, that is,
	\begin{equation*}
		X_t = \{ X_n \; : \; t_n = t \}.
	\end{equation*}
	Then the sequence $X$ is said to be partially exchangeable if all of its classes are exchangeable.
\end{definition}

A partially exchangeable sequence can be naturally grouped in an array-like fashion according to the different values that the covariates take. Specifically, suppose that $\calT = \{t_1, ..., t_d \}$, so that there are $d$ classes. Then the sequence $\left\{ (X_{t_i, \, n})_{n=1}^{\infty} \, : \, i=1, ..., d \right\}$ is a partially exchangeable sequence if $(X_{t_i, \, n})_{n=1}^{\infty}$ is exchangeable for each $i=1, ...d$. \\

Under the assumption that every class is countably infinite, a representation theorem analogous to \ref{thm:definetti} exists \cite{CampbellEtAl:2019:LocalExch}. Before giving a more formal statement, we showcase an example.


\begin{mdframed}[backgroundcolor=mygray] 
	\begin{example} 
		Consider an experiment in which two types of binary observations, $(X_{0, \, n})_{n=1}^{\infty}$ and $(X_{1, \, n})_{n=1}^{\infty}$, are under study. For example, $X_{0, \, i}$ could measure if a male patient recovered (1) or not (0) after taking a certain medication, while $X_{1, \, i}$ would measure the same outcome but for a female patient. In this case the covariate $t_n$ is also binary, and only indicates whether the patient is male (0) or female (1). Hence, there are two classes: $X_0$ and $X_1$, which correspond to male and female patients, respectively. \\
		
		If it is deemed that the value of the covariate does not affect the outcome of the variables, then exchangeability of the sequence $X = (X_0, X_1)$ might be a feasible assumption. If this is not so, it might still be feasible to assume exchangeability within male patients and whithin female patients. In that case, $X$ would be partially exchangeable. \\
		
		Furthermore, for such a partially exchangeable process there exists a measure $\mu$ such that, for every $l, r \in \bbN$,
				\begin{equation*}
			\bbP \{ X_{0, \, 1} = m_1, ..., X_{0, \, l} = m_l, X_{1, \, 1} = f_1, ..., X_{1, \, r} = f_r \} = \iint  \mu(dp_0, dp_1) \, p_0^{s_0} (1-p_0)^{l-s_0} \, p_1^{s_1} (1-p_1)^{r-s_1},
		\end{equation*}
		where $s_0 = \sum_{i=1}^l m_i$ and $s_1 = \sum_{i=1}^r f_i$ are the number of 1's in the male and female groups, respectively \cite[][p.~112-113]{Diaconis:1988:PartialExchang}.
	\end{example}
\end{mdframed}

We now state the representation theorem for general partially exchangeable sequences. (Adapted from \cite[][p.~69]{CamerlenghiEtAl:2019:partial_exchang_hierarchical}.)


\begin{theorem} \label{thm:definetti_partial}
	$\left\{ (X_{t_i, \, n})_{n=1}^{\infty} \, : \, i=1, ..., d \right\}$ is a partially exchangeable sequence if and only if there exists a unique probability measure $\mu$ on $\calP^d$ such that, for all $n_1, ..., n_d \in \bbN$ and $A_1, ..., A_d \in \calB(\calX)^{n_i}$,
	\begin{equation} \label{eq:definetti_partial_thm}
		\bbP \left\{ (X_{t_i, \, k})_{k=1}^{n_i} \in A_i \, : \, i=1, ..., d  \right\} = \int_{\calP^d}  \prod_{i=1}^d F_i(A_i) \, \mu(dF_1, ..., dF_d).
	\end{equation}
\end{theorem}



As per Theorem \ref{thm:definetti}, every distribution $F_i$ in Equation (\ref{eq:definetti_partial_thm}) is itself a product measure on $\calX^{n_i}$. \\


Finally, observe that partial exchangeability requires access to so-called replicates: at each value of the covariate, an infinite number of response variables can be, at least in theory, obtained (or considered). Although this is true for cases as the one in Example \ref{ex:binary_definetti}, it does not always hold.



\subsection{Local exchangeability}


Campbell et al. \cite{CampbellEtAl:2019:LocalExch} propose the notion of \textit{local exchangeability} for data with covariates. Both exchangeability and partial exchangeability require some sort of strict invariance under permutations. In this case this is relaxed to allow for some distributional variation under permutations, so long as this variation is bounded and proportional to how close the corresponding covariates are. Interestingly, a representation theorem can still be obtained in such a scenario. Before formalizing these ideas, we define a way to measure variation between distributions.


\begin{definition}[Total variation distance]
	Let $X, Y$ be random variables taking values in a measurable space $(E, \calE)$. Then the total variation between $X$ and $Y$ is
	\begin{equation*}
		d_{\mathrm{TV}} (X, Y) = \sup_{A \in \calE} \left| \bbP \{ X \in A \} - \bbP \{Y \in A \} \right|.
	\end{equation*}
\end{definition}


\begin{definition}[Local exchangeability]
	Let $X = (X_t)_{t \in \calT}$ be a sequence of random variables with covariate space $\calT$ and $d: \calT \times \calT \to \bbR_{+}$ a pseudometric (distances between different points need not be positive). The process $X$ is said to be $f$-locally exchangeable if there exists a function $f: \bbR_{+} \to \bbR_{+}$ continuous at zero and with $f(0) = 0$ such that, for every finite subset $T \subset \calT$ and permutation $\pi$ of $T$,
	\begin{equation} \label{eq:local_exch}
		d_{\mathrm{TV}} (X_T, X_{\pi T}) \leq \sum_{t \in T} f(d(t, \pi(t))).
	\end{equation}
\end{definition}


For a very rich discussion of this idea see \cite{CampbellEtAl:2019:LocalExch}, where the authors discuss e.g. the usage of the total variation distance instead of other divergence, and provide some examples of locally-exchangeable processes from the Bayesian nonparametrics literature. In the interest of brevity, we give a very simple example and state the main result, namely, the de Finetti-like representation theorem.



\begin{mdframed}[backgroundcolor=mygray] 
	\begin{example} 
		Consider a
	\end{example}
\end{mdframed}




% ...